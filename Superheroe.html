<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Equipos de Superhéroes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                        'shake': 'shake 0.82s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .shake-animation {
            animation: shake 0.5s;
        }
        /* Clase para destacar el equipo en combate */
        .battle-winner {
            border-color: #10B981 !important; /* Tailwind emerald-500 */
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.5), 0 4px 6px -2px rgba(16, 185, 129, 0.05) !important;
            animation: pulse-slow 2s infinite;
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-800 p-4">
    <div class="max-w-7xl mx-auto bg-white/95 backdrop-blur-sm rounded-3xl shadow-2xl p-6 md:p-8">
        <div class="text-center mb-8">
            <h1
                class="text-4xl md:text-6xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">
                🦸‍♂️ Generador de Equipos 🦸‍♀️
            </h1>
            <p class="text-gray-600 text-lg">Crea y gestiona equipos épicos de superhéroes</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div
                class="bg-gradient-to-r from-red-50 to-pink-50 p-6 rounded-2xl border-2 border-red-100 hover:shadow-lg transition-all duration-300">
                <h3 class="text-xl font-bold text-red-700 mb-4 flex items-center">
                    <span class="mr-2">📊</span> Gestión de Equipos
                </h3>
                <div class="space-y-3">
                    <button onclick="generateRandomTeam()"
                        class="w-full bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
                        🎲 Generar Equipo Aleatorio
                    </button>
                    <button onclick="analyzeCurrentTeam()"
                        class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
                        📈 Analizar Equipo
                    </button>
                    <button onclick="clearTeam()"
                        class="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
                        🗑️ Limpiar Equipo
                    </button>
                </div>
            </div>

            <div
                class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-2xl border-2 border-yellow-100 hover:shadow-lg transition-all duration-300">
                <h3 class="text-xl font-bold text-orange-700 mb-4 flex items-center">
                    <span class="mr-2">🔍</span> Filtros
                </h3>
                <div class="space-y-3">
                    <select id="powerFilter" onchange="filterHeroes()"
                        class="w-full p-3 border-2 border-orange-200 rounded-xl focus:border-orange-400 focus:outline-none bg-white shadow-sm">
                        <option value="">Todos los poderes</option>
                        <option value="Fuerza">💪 Fuerza</option>
                        <option value="Velocidad">⚡ Velocidad</option>
                        <option value="Vuelo">🦅 Vuelo</option>
                        <option value="Telepatía">🧠 Telepatía</option>
                        <option value="Invisibilidad">👻 Invisibilidad</option>
                        <option value="Control del Hielo">🧊 Control del Hielo</option>
                        <option value="Piroquinesis">🔥 Piroquinesis</option>
                        <option value="Regeneración">🩹 Regeneración</option>
                    </select>
                    <select id="levelFilter" onchange="filterHeroes()"
                        class="w-full p-3 border-2 border-orange-200 rounded-xl focus:border-orange-400 focus:outline-none bg-white shadow-sm">
                        <option value="">Todos los niveles</option>
                        <option value="high">🔥 Alto (80+)</option>
                        <option value="medium">⚖️ Medio (50-79)</option>
                        <option value="low">🌱 Bajo (0-49)</option>
                    </select>
                    <select id="originFilter" onchange="filterHeroes()"
                        class="w-full p-3 border-2 border-orange-200 rounded-xl focus:border-orange-400 focus:outline-none bg-white shadow-sm">
                        <option value="">Todos los orígenes</option>
                        <option value="Tierra">🌍 Tierra</option>
                        <option value="Japón">🗾 Japón</option>
                        <option value="Espacio">🚀 Espacio</option>
                        <option value="Marte">🔴 Marte</option>
                        <option value="Atlántida">🌊 Atlántida</option>
                        <option value="Olimpo">🏛️ Olimpo</option>
                        <option value="Dimensión X">🌀 Dimensión X</option>
                        <option value="Luna">🌙 Luna</option>
                        <option value="Reino Fantasma">👻 Reino Fantasma</option>
                        <option value="Polo Norte">❄️ Polo Norte</option>
                        <option value="Volcán">🌋 Volcán</option>
                        <option value="Laboratorio Secreto">🔬 Laboratorio Secreto</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-6 lg:col-span-1">
                <input type="text" id="searchFilter" oninput="filterHeroes()" placeholder="🔎 Buscar héroe por nombre, poder, origen..."
                    class="w-full p-3 border-2 border-orange-200 rounded-xl focus:border-orange-400 focus:outline-none bg-white shadow-sm">
                
                <div
                    class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-2xl border-2 border-green-100 hover:shadow-lg transition-all duration-300">
                    <h3 class="text-xl font-bold text-green-700 mb-4 flex items-center">
                        <span class="mr-2">⚡</span> Acciones Avanzadas
                    </h3>
                    <div class="space-y-3">
                        <button onclick="findStrongestHero()"
                            class="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
                            💪 Héroe Más Fuerte
                        </button>
                        <button onclick="createSuperTeam()"
                            class="w-full bg-gradient-to-r from-purple-500 to-violet-500 hover:from-purple-600 hover:to-violet-600 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg">
                            ⭐ Equipo Elite
                        </button>
                        <button onclick="simulateBattle()"
                            class="w-full bg-gradient-to-r from-red-600 to-pink-700 hover:from-red-700 hover:to-pink-800 text-white font-bold py-3 px-4 rounded-xl transform hover:scale-105 transition-all duration-200 shadow-lg shake-animation">
                            💥 ATACAR EQUIPO ENEMIGO
                        </button>
                    </div>
                </div>
            </div>

        </div>
        
        <div id="validationAlert" class="hidden mb-8">
            <div id="validationContent" class="p-4 rounded-2xl border-2 shadow-lg whitespace-pre-line"></div>
        </div>

        <div id="teamSummary" class="hidden mb-8">
            <div id="teamSummaryBox"
                class="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-2xl border-2 border-purple-200 shadow-lg transition-all duration-500">
                <div id="teamSummaryContent"></div>
                <div id="teamScore" class="mt-4 p-4 bg-purple-50 rounded-xl border border-purple-200 text-center hidden">
                    <p class="text-xl font-bold text-purple-700">Puntuación del Equipo: <span id="scoreValue" class="text-4xl text-pink-600">0</span></p>
                    <p class="text-lg text-gray-600">Valoración: <span id="scoreRating" class="font-bold text-pink-700"></span></p>
                </div>
            </div>
        </div>

        <div id="battleResult" class="hidden mb-8">
            <div id="battleContent" class="p-6 rounded-2xl border-2 shadow-xl text-center"></div>
        </div>


        <div id="searchResults" class="mb-4 hidden">
            <p id="searchResultsText" class="text-lg font-semibold text-gray-700"></p>
        </div>


        <div id="heroGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
            </div>

        <div id="output" class="hidden">
            <div class="bg-gray-900 text-green-400 p-6 rounded-2xl font-mono shadow-2xl border border-gray-700">
                <div class="flex items-center mb-3">
                    <div class="flex space-x-1">
                        <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                        <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                    </div>
                    <span class="ml-4 text-gray-400">Consola de Superhéroes</span>
                </div>
                <div id="outputContent" class="max-h-64 overflow-y-auto whitespace-pre-line"></div>
            </div>
        </div>
    </div>

    <script>
       const HERO_DATABASE = [
        // ¡Añadimos 3 nuevos superhéroes!
        { name: "Capitán Rayo", power: "Fuerza", level: 95, origin: "Tierra", weakness: "Kriptonita", emoji: "⚡" },
        { name: "Sombra Ninja", power: "Invisibilidad", level: 78, origin: "Japón", weakness: "Luz brillante", emoji: "🥷" },
        { name: "Flash Cósmico", power: "Velocidad", level: 88, origin: "Espacio", weakness: "Frío extremo", emoji: "💫" },
        { name: "Mente Maestra", power: "Telepatía", level: 82, origin: "Marte", weakness: "Metal", emoji: "🧠" },
        { name: "Águila Dorada", power: "Vuelo", level: 75, origin: "Atlántida", weakness: "Agua salada", emoji: "🦅" },
        { name: "Furia Titánica", power: "Fuerza", level: 92, origin: "Olimpo", weakness: "Amor verdadero", emoji: "💪" },
        { name: "Espectro Veloz", power: "Velocidad", level: 65, origin: "Dimensión X", weakness: "Gravedad", emoji: "👻" },
        { name: "Psíquico Supremo", power: "Telepatía", level: 89, origin: "Luna", weakness: "Emociones fuertes", emoji: "🌙" },
        { name: "Fantasma Plateado", power: "Invisibilidad", level: 71, origin: "Reino Fantasma", weakness: "Sal", emoji: "✨" },
        { name: "Guardián de Hielo", power: "Control del Hielo", level: 85, origin: "Polo Norte", weakness: "Fuego", emoji: "🧊" },
        { name: "Dama de Lava", power: "Piroquinesis", level: 90, origin: "Volcán", weakness: "Agua", emoji: "🌋" },
        { name: "Doctora Bio", power: "Regeneración", level: 79, origin: "Laboratorio Secreto", weakness: "Ruidos agudos", emoji: "🔬" },
        // --- Nuevos Héroes ---
        { name: "Tecnomante", power: "Tecnopatía", level: 87, origin: "Ciudad Futurista", weakness: "Ondas EMP", emoji: "🤖" },
        { name: "Flora Salvaje", power: "Control de Plantas", level: 73, origin: "Selva Amazónica", weakness: "Sequía", emoji: "🌿" },
        { name: "Maestro del Tiempo", power: "Manipulación Temporal", level: 98, origin: "Vórtice Cuántico", weakness: "Inercia", emoji: "⏳" }
        // -----------------------
    ];
    let currentTeam = [];
    let filteredHeroes = [...HERO_DATABASE];
    const TEAM_NAMES = ['Los Inmortales', 'Fuerza Delta', 'Vanguardia Cósmica', 'Centinelas de la Justicia', 'Los Guardianes del Nexus', 'Los Defensores del Mañana'];

    // --- FUNCIONES DE UTILIDAD GENERALES ---
    const showOutput = (message) => {
        const outputDiv = document.getElementById('output');
        const outputContent = document.getElementById('outputContent');
        outputContent.innerHTML += `<div class="mb-1">${new Date().toLocaleTimeString()} > ${message}</div>`;
        outputDiv.classList.remove('hidden');
        outputContent.scrollTop = outputContent.scrollHeight;
        // Scroll automático
        // Animar el color de fondo para indicar una nueva entrada
        outputContent.classList.add('bg-green-700', 'animate-pulse');
        setTimeout(() => outputContent.classList.remove('bg-green-700', 'animate-pulse'), 500);
    };

    const getRandomHero = () => HERO_DATABASE[Math.floor(Math.random() * HERO_DATABASE.length)];
    const shuffleArray = (array) => {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    };
    const checkLevelRange = (level, range) => {
        switch (range) {
            case 'high': return level >= 80;
            case 'medium': return level >= 50 && level < 80;
            case 'low': return level < 50;
            default: return true;
        }
    };

    // --- SISTEMA DE PUNTUACIÓN (Ya implementado, usado como base para el combate) ---
    const calculateTeamScore = (team) => {
        if (!team || team.length === 0) return 0;
        let score = 0;
        const powerCounts = {};
        const originCounts = {};
        // Puntos base por nivel de poder
        team.forEach(hero => {
            score += hero.level * 2; // Multiplicador para hacerlo más relevante
            powerCounts[hero.power] = (powerCounts[hero.power] || 0) + 1;
            originCounts[hero.origin] = (originCounts[hero.origin] || 0) + 1;
        });
        // Bonificaciones por diversidad de poderes
        const uniquePowers = Object.keys(powerCounts).length;
        score += uniquePowers * 50; // 50 puntos por cada poder único

        // Bonificación por equipo completo (5 miembros)
        if (team.length === 5) {
            score += 100;
        }

        // Penalización por tener muchos poderes repetidos
        Object.values(powerCounts).forEach(count => {
            if (count > 2) {
                score -= (count - 2) * 50;
            }
        });
        return Math.max(1, score); // Mínimo 1 de score para evitar divisiones por cero
    };

    const getScoreRating = (score) => {
        if (score >= 1200) return "🏆 ¡ÉPICO!";
        if (score >= 900) return "⭐ Excelente";
        if (score >= 600) return "👍 Muy Bueno";
        if (score >= 300) return "✅ Bueno";
        return "📈 Mejorable";
    };
    const updateTeamScore = () => {
        const scoreElement = document.getElementById('teamScore');
        const scoreValue = document.getElementById('scoreValue');
        const scoreRating = document.getElementById('scoreRating');

        if (currentTeam.length > 0) {
            const score = calculateTeamScore(currentTeam);
            scoreValue.textContent = score;
            scoreRating.textContent = getScoreRating(score);
            scoreElement.classList.remove('hidden');
        } else {
            scoreElement.classList.add('hidden');
        }
    };

    const calculateTeamStats = () => {
        if (currentTeam.length === 0) return null;
        const initialStats = {
            totalPower: 0,
            maxPower: 0,
            minPower: 100,
            memberCount: 0,
            powerDistribution: {},
            originDistribution: {}
        };
        const stats = currentTeam.reduce((stats, hero) => {
            stats.totalPower += hero.level;
            stats.maxPower = Math.max(stats.maxPower, hero.level);
            stats.minPower = Math.min(stats.minPower, hero.level);
            stats.memberCount += 1;
            stats.powerDistribution[hero.power] = (stats.powerDistribution[hero.power] || 0) + 1;
            stats.originDistribution[hero.origin] = (stats.originDistribution[hero.origin] || 0) + 1;
            return stats;
        }, initialStats);

        stats.avgPower = Math.round(stats.totalPower / stats.memberCount);
        return stats;
    };


    // --- GESTIÓN DE EQUIPOS ---

    const setTeam = (newTeam) => {
        currentTeam = newTeam.slice(0, 5);
        updateTeamScore();
        updateDisplay();
    };
    const clearTeam = () => {
        setTeam([]);
        document.getElementById('validationAlert').classList.add('hidden');
        document.getElementById('teamSummary').classList.add('hidden');
        document.getElementById('battleResult').classList.add('hidden');
        document.getElementById('teamSummaryBox').classList.remove('battle-winner');
        showOutput("🗑️ Equipo limpiado.");
    };
    const generateRandomTeam = () => {
        const shuffled = shuffleArray([...HERO_DATABASE]);
        const randomTeam = shuffled.slice(0, 5);
        setTeam(randomTeam);
        showOutput(`🎲 Generado equipo aleatorio de ${randomTeam.length} héroes. Nombre: ${generateTeamName()}`);
    };
    const createSuperTeam = () => {
        const superTeam = [...HERO_DATABASE]
            .sort((a, b) => b.level - a.level)
            .slice(0, 5);
        setTeam(superTeam);
        showOutput(`⭐ Generado Equipo Elite (Top 5 en poder).`);
    };

    const analyzeCurrentTeam = () => {
        validateTeam();
        showTeamStats();
        showOutput("📈 Análisis de equipo completado.");
    };
    const findStrongestHero = () => {
        if (HERO_DATABASE.length === 0) {
            showOutput("❌ Base de datos vacía.");
            return;
        }
        
        const strongest = HERO_DATABASE.reduce((max, hero) => (hero.level > max.level ? hero : max), HERO_DATABASE[0]);
        setTeam([strongest]);
        showOutput(`💪 Héroe Más Fuerte encontrado: ${strongest.name} (Nivel ${strongest.level}, Poder: ${strongest.power})`);
    };

    // --- SISTEMA DE COMBATE (Nivel Avanzado) ---

    const simulateBattle = () => {
        if (currentTeam.length === 0) {
            showOutput("❌ No puedes atacar sin un equipo. ¡Añade héroes primero!");
            return;
        }
        
        // 1. Crear el equipo enemigo
        const enemyTeam = shuffleArray([...HERO_DATABASE]).slice(0, Math.min(5, Math.max(3, Math.floor(Math.random() * 5) + 1)));
        const enemyScore = calculateTeamScore(enemyTeam);
        const playerTeamName = generateTeamName();
        const enemyTeamName = generateTeamName(true); // Generar un nombre de equipo enemigo
        
        // 2. Calcular scores (fuerza de combate)
        const playerScore = calculateTeamScore(currentTeam);

        // 3. Determinar el ganador (probabilístico basado en la relación de scores)
        const totalScore = playerScore + enemyScore;
        // Ponderación de la victoria basada en la fuerza
        const playerWinChance = (playerScore / totalScore) * 100;
        
        // Simulación: el jugador gana si un número aleatorio es menor que su probabilidad de victoria
        const roll = Math.random() * 100;
        const playerWins = roll < playerWinChance;

        // 4. Mostrar el resultado
        const resultDiv = document.getElementById('battleResult');
        const contentDiv = document.getElementById('battleContent');
        const summaryBox = document.getElementById('teamSummaryBox');
        let resultHtml = '';
        
        summaryBox.classList.remove('battle-winner'); // Limpiar animación previa
        
        if (playerWins) {
            summaryBox.classList.add('battle-winner');
            resultHtml = `
                <p class="text-4xl font-extrabold text-green-600 mb-2">🎉 ¡VICTORIA! 🎉</p>
                <p class="text-xl font-bold text-gray-800">${playerTeamName} ha derrotado a ${enemyTeamName}.</p>
                <p class="text-lg text-gray-600 mt-2">Tu Equipo (Puntuación: ${playerScore}) superó al enemigo (Puntuación: ${enemyScore}).</p>
            `;
            showOutput(`💥 ¡Batalla ganada! Tu equipo (${playerScore}) vs Enemigo (${enemyScore}).`);
        } else {
            resultHtml = `
                <p class="text-4xl font-extrabold text-red-600 mb-2">😭 ¡DERROTA! 😭</p>
                <p class="text-xl font-bold text-gray-800">${enemyTeamName} ha prevalecido sobre ${playerTeamName}.</p>
                <p class="text-lg text-gray-600 mt-2">Tu Equipo (Puntuación: ${playerScore}) fue superado por el enemigo (Puntuación: ${enemyScore}).</p>
            `;
            showOutput(`💥 ¡Batalla perdida! Tu equipo (${playerScore}) vs Enemigo (${enemyScore}).`);
        }
        
        resultDiv.classList.remove('hidden');
        contentDiv.innerHTML = resultHtml;
        contentDiv.className = `p-6 rounded-2xl border-2 shadow-xl text-center ${playerWins ? 'bg-green-100 border-green-400' : 'bg-red-100 border-red-400'}`;
        
        // Forzar el recálculo de estadísticas para mostrar el nombre
        showTeamStats();
    };

    // --- VISUALIZACIÓN DE ESTADÍSTICAS ---

    const getStatsHtml = (stats) => {
        // ... (El resto de la función getStatsHtml se mantiene igual)
        if (!stats) {
            return '<p class="text-red-600 font-bold">No hay héroes en el equipo para calcular estadísticas.</p>';
        }

        const powerHtml = Object.entries(stats.powerDistribution).map(([power, count]) => 
            `<li>${power}: ${count}</li>`
        ).join('');
        const originHtml = Object.entries(stats.originDistribution).map(([origin, count]) => 
            `<li>${origin}: ${count}</li>`
        ).join('');
        return `
            <h4 class="text-2xl font-bold text-purple-700 mb-4">Resumen Estadístico del Equipo (${generateTeamName()})</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-xl shadow-inner border border-purple-200">
                    <p class="text-lg font-semibold text-gray-700">Miembros: <span class="text-purple-600 font-bold">${stats.memberCount}/5</span></p>
                    <p class="text-lg font-semibold text-gray-700">Poder Total: <span class="text-purple-600 font-bold">${stats.totalPower}</span></p>
                    <p class="text-lg font-semibold text-gray-700">Poder Promedio: <span class="text-purple-600 font-bold">${stats.avgPower}</span></p>
                    <p class="text-lg font-semibold text-gray-700">Nivel Máx: <span class="text-purple-600 font-bold">${stats.maxPower}</span></p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-inner border border-purple-200">
                    <p class="font-bold text-gray-800 mb-2">Distribución de Poderes:</p>
                    <ul class="list-disc list-inside text-sm">${powerHtml}</ul>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-inner border border-purple-200 col-span-full">
                    <p class="font-bold text-gray-800 mb-2">Distribución de Orígenes:</p>
                    <ul class="list-disc list-inside text-sm">${originHtml}</ul>
                </div>
            </div>
        `;
    };

    const showTeamStats = () => {
        const summaryElement = document.getElementById('teamSummary');
        const summaryContent = document.getElementById('teamSummaryContent');
        
        const stats = calculateTeamStats();
        
        summaryContent.innerHTML = getStatsHtml(stats);
        if (stats) {
            summaryElement.classList.remove('hidden');
            showOutput("📊 Estadísticas del equipo calculadas y mostradas.");
        } else {
            // No ocultar si hay resultado de batalla.
        }
    };
    // --- BÚSQUEDA Y FILTRO ---
    // (Funciones filterHeroes, updateSearchResults, hasActiveFilters y clearFilters se mantienen igual)
    const filterHeroes = () => {
        const searchText = document.getElementById('searchFilter').value.toLowerCase().trim();
        const powerFilter = document.getElementById('powerFilter').value;
        const levelFilter = document.getElementById('levelFilter').value;
        const originFilter = document.getElementById('originFilter').value;
        filteredHeroes = HERO_DATABASE.filter(hero => {
            // Búsqueda por texto en nombre, poder, origen y debilidad
            const textMatch = !searchText || 
                hero.name.toLowerCase().includes(searchText) ||
                hero.power.toLowerCase().includes(searchText) ||
                hero.origin.toLowerCase().includes(searchText) ||
                hero.weakness.toLowerCase().includes(searchText);
            
            const powerMatch = !powerFilter || hero.power === powerFilter;
            const levelMatch = !levelFilter || checkLevelRange(hero.level, levelFilter);
            const originMatch = !originFilter || hero.origin === originFilter;
            
            return textMatch && powerMatch && levelMatch && originMatch;
        });

        updateDisplay();
        updateSearchResults(searchText);
        if (searchText || powerFilter || levelFilter || originFilter) {
            showOutput(`🔍 Filtrados: ${filteredHeroes.length} héroes encontrados`);
        }
    };

    const updateSearchResults = (searchText) => {
        const searchResults = document.getElementById('searchResults');
        const searchResultsText = document.getElementById('searchResultsText');
        
        if (searchText || hasActiveFilters()) {
            searchResults.classList.remove('hidden');
            let resultText = `Mostrando ${filteredHeroes.length} de ${HERO_DATABASE.length} héroes`;
            
            if (searchText) {
                resultText += ` que coinciden con "${searchText}"`;
            }
            
            searchResultsText.textContent = resultText;
        } else {
            searchResults.classList.add('hidden');
        }
    };
    const hasActiveFilters = () => {
        return document.getElementById('powerFilter').value ||
               document.getElementById('levelFilter').value ||
               document.getElementById('originFilter').value;
    };
    const clearFilters = () => {
        document.getElementById('searchFilter').value = '';
        document.getElementById('powerFilter').value = '';
        document.getElementById('levelFilter').value = '';
        document.getElementById('originFilter').value = '';
        filterHeroes();
        showOutput("🧹 Filtros limpiados.");
    };

    // --- VALIDACIONES DE EQUIPO ---
    // (Función validateTeam y showValidationAlert se mantienen igual)
    const validateTeam = () => {
        if (currentTeam.length === 0) {
            showValidationAlert("⚠️ No hay equipo para validar", "warning");
            return;
        }

        const validations = [];
        const warnings = [];
        const powerCounts = {};
        
        // Contar poderes
        currentTeam.forEach(hero => {
            powerCounts[hero.power] = (powerCounts[hero.power] || 0) + 1;
        });
        // Validación 1: Tamaño del equipo
        if (currentTeam.length < 3) {
            validations.push("❌ Equipo muy pequeño (mínimo 3 héroes)");
        } else if (currentTeam.length > 5) {
            validations.push("❌ Equipo muy grande (máximo 5 héroes)");
        } else {
            validations.push("✅ Tamaño del equipo correcto");
        }

        // Validación 2: Poder promedio
        const avgPower = currentTeam.reduce((sum, hero) => sum + hero.level, 0) / currentTeam.length;
        if (avgPower < 60) {
            warnings.push("⚠️ Poder promedio bajo (" + Math.round(avgPower) + ")");
        } else if (avgPower >= 80) {
            validations.push("✅ Equipo de alto poder (" + Math.round(avgPower) + ")");
        } else {
            validations.push("✅ Poder promedio aceptable (" + Math.round(avgPower) + ")");
        }

        // Validación 3: Diversidad de poderes
        const uniquePowers = Object.keys(powerCounts).length;
        if (uniquePowers === currentTeam.length) {
            validations.push("✅ Excelente diversidad de poderes");
        } else if (uniquePowers < 2) {
            warnings.push("⚠️ Falta diversidad de poderes");
        } else {
            validations.push("✅ Buena diversidad de poderes");
            Object.entries(powerCounts).forEach(([power, count]) => {
                if (count > 1) {
                    warnings.push(`⚠️ Poder duplicado: ${power} (${count} veces)`);
                }
            });
        }

        // Validación 4: Balance de roles
        const hasSupport = currentTeam.some(h => h.power === "Regeneración" || h.power === "Telepatía");
        const hasTank = currentTeam.some(h => h.power === "Fuerza" && h.level >= 80);
        const hasDPS = currentTeam.some(h => h.power === "Velocidad" || h.power === "Piroquinesis");
        if (hasSupport && hasTank && hasDPS) {
            validations.push("✅ Equipo bien balanceado (Tank, DPS, Support)");
        } else {
            const missing = [];
            if (!hasTank) missing.push("Tank (Fuerza > 80)");
            if (!hasDPS) missing.push("DPS (Velocidad/Piroquinesis)");
            if (!hasSupport) missing.push("Support (Regeneración/Telepatía)");
            warnings.push(`⚠️ Faltan roles clave: ${missing.join(", ")}`);
        }

        // Validación 5: Debilidades compartidas
        const weaknesses = currentTeam.map(h => h.weakness);
        const weaknessCounts = weaknesses.reduce((acc, w) => {
            acc[w] = (acc[w] || 0) + 1;
            return acc;
        }, {});
        const sharedWeaknesses = Object.entries(weaknessCounts)
                                      .filter(([w, count]) => count > 1)
                                      .map(([w]) => w);
        if (sharedWeaknesses.length > 0) {
            warnings.push(`⚠️ Debilidades compartidas: ${sharedWeaknesses.join(", ")}`);
        } else {
            validations.push("✅ Sin debilidades compartidas");
        }

        // Mostrar resultados
        const allResults = [...validations, ...warnings];
        const isValid = warnings.length === 0 && currentTeam.length >= 3 && currentTeam.length <= 5;
        const alertType = isValid ? "success" : "warning";
        
        showValidationAlert(allResults.join("\n"), alertType);
        showOutput(`🔍 Validación completada: ${validations.length} ✅, ${warnings.length} ⚠️`);
    };
    const showValidationAlert = (message, type) => {
        const alert = document.getElementById('validationAlert');
        const content = document.getElementById('validationContent');
        
        const typeClasses = {
            success: 'bg-green-50 border-green-300 text-green-800',
            warning: 'bg-yellow-50 border-yellow-300 text-yellow-800',
            error: 'bg-red-50 border-red-300 text-red-800'
        };
        content.className = `p-4 rounded-2xl border-2 shadow-lg whitespace-pre-line ${typeClasses[type]}`;
        content.textContent = message;
        alert.classList.remove('hidden');
        // Auto-hide después de 10 segundos
        setTimeout(() => {
            alert.classList.add('hidden');
        }, 10000);
    };

    // --- RENDERIZACIÓN DE LA INTERFAZ ---

    const generateTeamName = (isEnemy = false) => {
        // Modifica los nombres de equipo (Nivel Básico)
        const teamNames = isEnemy ? 
            ['Los Tiranos', 'Destructores', 'La Plaga', 'El Eje del Mal', 'Siniestros'] : 
            TEAM_NAMES;
        
        const name = teamNames[Math.floor(Math.random() * teamNames.length)];
        return name;
    };
    const createHeroCard = (hero) => {
        const levelColor = hero.level >= 80 ?
            'from-red-500 to-pink-500' :
            hero.level >= 60 ?
                'from-yellow-500 to-orange-500' :
                'from-blue-500 to-cyan-500';
        const inTeam = currentTeam.some(h => h.name === hero.name);
        const borderColor = inTeam ? 'border-green-400 ring-4 ring-green-200' : 'border-gray-200';
        const buttonText = inTeam ? '✅ En Equipo' : (currentTeam.length < 5 ? '➕ Añadir' : '❌ Equipo Completo');
        const buttonClasses = inTeam ? 'bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600' :
                              (currentTeam.length < 5 ? 'bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600' : 'bg-gray-400 cursor-not-allowed');
        return `
            <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all duration-300 ${borderColor} border-2 p-6 cursor-pointer group"
                onclick="toggleHeroInTeam('${hero.name}')">
                <div class="text-center mb-4">
                    <div class="text-6xl mb-2 group-hover:animate-bounce-slow">${hero.emoji}</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${hero.name}</h3>
                    <span class="inline-block bg-gradient-to-r ${levelColor} text-white px-4 py-2 rounded-full font-bold text-sm shadow-md">
                        Nivel ${hero.level}
                    </span>
                </div>
                
                <div class="space-y-2 text-sm text-gray-600">
                    <div class="flex justify-between">
                        <span class="font-semibold">Poder:</span>
                        <span class="text-purple-600 font-bold">${hero.power}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-semibold">Origen:</span>
                        <span class="text-blue-600">${hero.origin}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-semibold">Debilidad:</span>
                        <span class="text-red-500">${hero.weakness}</span>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <button class="${buttonClasses} text-white px-4 py-2 rounded-lg font-semibold transition-all duration-200 transform group-hover:scale-110">
                        ${buttonText}
                    </button>
                </div>
            </div>
        `;
    };

    const toggleHeroInTeam = (heroName) => {
        const hero = HERO_DATABASE.find(h => h.name === heroName);
        const heroIndex = currentTeam.findIndex(h => h.name === heroName);

        if (heroIndex >= 0) {
            currentTeam = currentTeam.filter(h => h.name !== heroName);
            showOutput(`❌ ${heroName} removido del equipo`);
        } else {
            addHeroToTeam(hero);
        }
        
        updateTeamScore();
        updateDisplay();
    };
    const addHeroToTeam = (hero) => {
        const heroExists = currentTeam.find(h => h.name === hero.name);
        if (!heroExists && currentTeam.length < 5) {
            currentTeam = [...currentTeam, hero];
            showOutput(`✅ ${hero.name} añadido al equipo!`);
        } else if (currentTeam.length >= 5) {
            showOutput(`❌ El equipo está completo (máximo 5 héroes)`);
        } else {
            showOutput(`❌ ${hero.name} ya está en el equipo`);
        }
    };

    const renderHeroGrid = () => {
        const heroGrid = document.getElementById('heroGrid');
        heroGrid.innerHTML = filteredHeroes.map(createHeroCard).join('');
    };

    const updateDisplay = () => {
        renderHeroGrid();
        updateTeamScore();
        // Ocultar resumen, validación y resultado de batalla al cambiar la composición del equipo manualmente
        document.getElementById('validationAlert').classList.add('hidden');
        document.getElementById('teamSummary').classList.add('hidden');
        document.getElementById('battleResult').classList.add('hidden');
        document.getElementById('teamSummaryBox').classList.remove('battle-winner');
    };

    // Inicialización al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
        updateDisplay();
        showOutput("🚀 Generador de Equipos de Superhéroes cargado.");
    });
    </script>
</body>

</html>